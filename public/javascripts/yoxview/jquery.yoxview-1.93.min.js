/*
 * jquery.yoxview
 * jQuery image gallery viewer
 * http://yoxigen.com/yoxview
 *
 * Copyright (c) 2010 Yossi Kolesnicov
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Date: 22nd June, 2010
 * Version : 1.93
 */ 
var yoxviewApi;
(function(v){var w;v.yoxviewUnload=function(){if(yoxviewApi){yoxviewApi.unload();yoxviewApi=null}};v(window).unload(function(){v.yoxviewUnload()});v.fn.extend({yoxview:function(O){if(this.length==0)return this;w||(w=typeof _yoxviewPath!="undefined"?_yoxviewPath:Yox.getPath(/(.*)jquery.yoxview.*/i));this.loadLanguage=function(q,P){var Q=this;if(yoxviewLanguages[q])Yox.loadDataSource(x,P,Q);else{yoxviewLanguages[q]={};v.ajax({url:w+"lang/"+q+".js",async:false,dataType:"json",success:function(H){yoxviewLanguages[q]=H;
Yox.loadDataSource(x,P,Q)}})}};var x=v.extend({autoPlay:false,backgroundColor:"#000",backgroundOpacity:0.8,buttonsFadeTime:500,cacheImagesInBackground:true,controlsInitialFadeTime:1500,controlsInitialDisplayTime:1E3,dataFolder:w+"data/",imagesFolder:w+"images/",infoBackColor:"Black",infoBackOpacity:0.5,isRTL:false,lang:"en",langFolder:w+"lang/",loopPlay:true,playDelay:3E3,popupMargin:20,popupResizeTime:600,renderButtons:true,renderMenu:true,showBarsOnOpen:true,showButtonsOnOpen:true,titleAttribute:"title",
titleDisplayDuration:2E3},O);yoxviewApi?this.loadLanguage(x.lang,function(q){yoxviewApi.AddViews(q,x)}):this.loadLanguage(x.lang,function(q){yoxviewApi=new YoxView(q,x)});return this}})})(jQuery);var yoxviewLanguages=[];
function YoxView(v,w){function O(a){a=e(a).data("yoxview");if(!t||ma!=a.viewIndex){t=a.images;j=t.length;ma=a.viewIndex;var b=false;if(a.options&&!Yox.compare(c,a.options)){c=a.options;b=true}else if(!a.options&&!Yox.compare(c,na)){c=na;b=true}else if(I&&j==1||i&&!I&&j>0)b=true;if(b){if(i){i.parent().remove();y=z=R=E=aa=I=i=undefined;A=r=0}oa()}}}function x(a){var b=a.children("img:first"),d={thumbnailImg:b,thumbnailSrc:b.attr("src")},f=a.attr("href");if(f.match(Yox.imageRegex))e.extend(d,{media:{src:a.attr("href"),
title:b.attr(c.titleAttribute),alt:b.attr("alt")}});else for(videoProvider in za)if(f.match(za[videoProvider])){e.extend(d,{media:{type:"video",provider:videoProvider,url:f}});break}return d}function q(a,b,d){a=e(a);a.data("yoxview",{viewIndex:b});if(!Yox.compare(c,d))a.data("yoxview").options=d;var f=[];(a[0].tagName=="A"?a:a.find("a:has(img)")).each(function(g,l){f.push(x(e(l)))});if(d.images)f=f.concat(d.images);if(d.dataSource)Yox.dataSources[d.dataSource].getImagesData(d,function(g){f=f.concat(g.images);
a.data("yoxview").images=f;var l=g.isGroup?[e.extend(g,{media:{title:g.title+" ("+g.images.length+" images)",alt:g.title}})]:g.images;P(a,l,!g.createGroups?null:function(m){var B=e(m.currentTarget).data("yoxview"),pa=e(m.currentTarget);m=pa.data("yoxthumbs");if(B.imagesAreSet)h.openGallery(B.viewIndex);else{pa.css("cursor","wait");var ba=e.extend({},c);if(ba.dataSourceOptions)e.extend(ba.dataSourceOptions,m);else ba.dataSourceOptions=m;Yox.dataSources[c.dataSource].getImagesData(ba,function(Ja){B.images=
Ja.images;B.imagesAreSet=true;pa.css("cursor","");h.openGallery(B.viewIndex)})}});a.yoxthumbs("thumbnails").each(function(m,B){e(B).data("yoxview",{viewIndex:F.length});F.push(B)});if(!h.firstViewWithImages&&g.images.length>0){h.firstViewWithImages=a;d.cacheImagesInBackground&&h.startCache()}});else{a.data("yoxview").images=f;P(a)}}function P(a,b,d){a.yoxthumbs({images:b,onClick:d||function(f){c.thumbnailsOptions&&c.thumbnailsOptions.onClick?c.thumbnailsOptions.onClick(e(f.currentTarget).data("yoxthumbs").imageIndex,
e(f.currentTarget),e(f.liveFired).data("yoxview").viewIndex):h.openGallery(e(f.liveFired||f.currentTarget).data("yoxview").viewIndex,e(f.currentTarget).data("yoxthumbs").imageIndex);return false}})}function Q(a){var b=e(F[ma]);S=b[0].tagName=="A"?b:b.yoxthumbs("thumbnails").eq(r);if(S.length==0)S=b.yoxthumbs("thumbnails").eq(0);if(b=S.children("img:first")){a&&E&&E.attr("src",b.attr("src"));qa=b.offset();n={width:b.width(),height:b.height(),top:qa.top-e(window).scrollTop(),left:qa.left}}}function H(a){a.stop().fadeIn(c.buttonsFadeTime,
function(){e(this).delay(500).fadeOut(c.buttonsFadeTime)})}function Ka(a){e(a).stop().animate({opacity:0.5},c.buttonsFadeTime)}function ra(a,b,d){var f=e("<a>",{href:"#",click:function(){return h.clickBtn(h[b],d)}});e("<span>"+a+"</span>").css("opacity","0").appendTo(f);f.append(T.getSprite("icons",b));return f}function Aa(a,b,d){var f=new Image;f.src=c.imagesFolder+b+".png";d=e("<a>",{css:{background:"url("+f.src+") no-repeat "+b+" center",opacity:"0",outline:"0"},className:"yoxview_ctlBtn",title:d,
href:"#",click:function(){this.blur();return h.clickBtn(a,true)}});d.css(b,"0");return d}function oa(){o=yoxviewLanguages[c.lang];i=e("<div>",{id:"yoxview"});i.appendTo(e(parent.document.body));z=e("<div>",{className:"yoxview_imgPanel",css:{"z-index":"2"}});y=e("<div>",{className:"yoxview_imgPanel",css:{"z-index":"1",display:"none"}});E=e("<img />",{className:"yoxview_fadeImg",css:{display:"block",width:"100%",height:"100%"}});R=e("<img />",{className:"yoxview_fadeImg",css:{display:"block",width:"100%",
height:"100%"}});z.data("yoxviewPanel",{image:E}).append(E).appendTo(i);y.data("yoxviewPanel",{image:R});y.append(R).appendTo(i);var a=j==1;if(c.renderMenu!==false){var b=e("<div>",{className:"yoxview_popupBarPanel yoxview_top"});c.autoHideMenu!==false&&b.mouseenter(function(){h.isOpen&&Ba()}).mouseleave(function(){h.isOpen&&sa()});C=e("<div>",{id:"yoxview_menuPanel",css:{opacity:"0.8","background-position":T.getBackgroundPosition("menu","back")}});var d=ra(o.Help,"help",false),f=ra(o.Slideshow,"play",
false);C.append(ra(o.Close,"close",true),d,f);if(a){f.css("display","none");d.css("display","none");C.css({width:58})}C.find("a:last-child").attr("class","last");b.append(C).appendTo(i);C.delegate("a","mouseenter",function(){e(this).stop().animate({top:"8px"},"fast").find("span").stop().animate({opacity:1},"fast")}).delegate("a","mouseleave",function(){e(this).stop().animate({top:"0"},"fast").find("span").stop().animate({opacity:0},"fast")})}if(c.renderButtons!==false&&!a){I=Aa(h.prev,c.isRTL?"right":
"left",o.PrevImage);I.appendTo(i);aa=Aa(h.next,c.isRTL?"left":"right",o.NextImage);aa.appendTo(i)}J=i.find(".yoxview_ctlBtn");ca=e("<div>",{id:"yoxview_ajaxLoader",className:"yoxview_notification",css:{display:"none"}});ca.append(e("<img>",{src:c.imagesFolder+"popup_ajax_loader.gif",alt:o.Loading,css:{width:32,height:32,"background-image":"url("+c.imagesFolder+"sprites.png)","background-position":T.getBackgroundPosition("notifications","empty")}})).appendTo(i);jQuery.each(["play","pause","first",
"last"],function(g,l){var m=T.getSprite("notifications",l);m.attr("className","yoxview_notification").css("display","none").appendTo(i);U[l]=m});G=e("<div>",{id:"yoxview_helpPanel",href:"#",title:o.CloseHelp,css:{background:"url("+c.imagesFolder+"help_panel.png) no-repeat center top",direction:o.Direction,opacity:"0"},click:function(){return h.clickBtn(h.help,false)}});b=document.createElement("h1");b.innerHTML=o.Help.toUpperCase();d=document.createElement("p");d.innerHTML=o.HelpText;f=document.createElement("span");
f.id="yoxview_closeHelp";f.innerHTML=o.CloseHelp;G.append(b).append(d).append(f).appendTo(i);K=e("<div>",{className:"yoxview_popupBarPanel yoxview_bottom"});c.autoHideInfo!==false&&K.mouseenter(function(){h.isOpen&&!V&&da()}).mouseleave(function(){h.isOpen&&!V&&W()});X=e("<div>",{id:"yoxview_infoPanel"});X.append(e("<div>",{id:"yoxview_infoPanelBack",css:{background:c.infoBackColor,opacity:c.infoBackOpacity}}));ta=e("<div>",{id:"yoxview_infoPanelContent"});ea=e("<span>",{id:"yoxview_count"});Y=e("<div>",
{id:"yoxview_infoText"});if(a){Y.css("margin-left","10px");ea.css("display","none")}if(c.linkToOriginalContext!==false){L=e("<a>",{className:"yoxviewInfoLink",target:"_blank",title:o.OriginalContext});L.append(T.getSprite("icons","link"))}ta.append(ea,L,Y);X.append(ta).appendTo(K);i.append(K);a=e("<div>",{id:"yoxview_popupWrap",css:{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",display:"none","z-index":"100"}});i.wrap(a);ua=e("<div>",{css:{position:"fixed",height:"100%",width:"100%",
top:"0",left:"0",background:c.backgroundColor,"z-index":"1",opacity:c.backgroundOpacity},click:function(){return h.clickBtn(h.close,true)}}).appendTo(i.parent());c.buttonsFadeTime!=0&&J.hover(function(){h.isOpen&&e(this).stop().animate({opacity:0.5},c.buttonsFadeTime)},function(){e(this).stop().animate({opacity:0},c.buttonsFadeTime)})}function u(a){if(a==j)a=0;var b=t[a].media;if(b&&!b.loaded){A=a;if(!b.type||b.type==="image")Ca.src=b.src;else Da(b,function(){u(A+1)})}else{b=a+1;if(b==j)b=0;var d=
t[b].media;if(d&&!d.loaded)u(b);else{b=a-1;if(b<0)b=j-1;(d=t[b].media)&&!d.loaded&&u(b)}}}function Ea(){va=true;ca.stop().stopTime().oneTime(c.buttonsFadeTime,function(){e(this).stop().css("opacity","0.6").fadeIn(c.buttonsFadeTime)})}function Fa(a,b,d,f){var g={width:a,height:b};if(a>d){g.height=Math.round(d/a*b);g.width=d}if(g.height>f){g.width=Math.round(f/g.height*g.width);g.height=f}return g}function wa(a,b,d,f,g){i.stop().animate({width:a,height:b,top:d,left:f},c.popupResizeTime,g)}function fa(){if(j!=
1){p=true;if(r<j-1)i.oneTime(c.playDelay,"play",function(){h.next()});else c.loopPlay?i.oneTime(c.playDelay,"play",function(){h.select(0,null)}):M()}}function M(){i.stopTime("play");p=false}function Ga(){var a=e(parent.window).width(),b=e(parent.window).height();return{height:b,width:a,usableHeight:b-c.popupMargin*2,usableWidth:a-c.popupMargin*2}}function da(a){clearTimeout(Z);var b=Y.outerHeight();if(b<Ha)b=Ha;X.stop().animate({height:b},500,function(){a&&a()})}function W(a){clearTimeout(Z);X.stop().animate({height:0},
500,function(){a&&a()})}function sa(a){clearTimeout(xa);C.stop().animate({top:La},500,function(){a&&a()})}function Ba(a){clearTimeout(xa);C.stop().animate({top:0},500,function(){a&&a()})}function ga(a){var b,d=!a.type||a.type==="image";d&&V&&K.css("display","block");clearTimeout(Z);if(z.css("z-index")==1){k=z;b=E;ha=y}else{k=y;b=R;ha=z}k.data("maxSize",{width:a.width,height:a.height});var f=Fa(a.width,a.height,s.usableWidth,s.usableHeight),g=a.title||"";if(a.description)g+=g!=""?"<div id='yoxview_infoTextDescription'>"+
a.description+"</div>":a.description;Y.html(g);j>1&&ea.html(r+1+"/"+j);if(L)D.link?L.attr("href",D.link).css("display","inline"):L.css("display","none");g=k.data("yoxviewPanel");if(d){b.attr({src:a.src,title:a.title,alt:a.alt});J.css({height:"100%",width:"50%",top:"0"});if(k.isMedia){g.media.remove();g.media=undefined;g.image.show();k.isMedia=false}V=false}else{if(g.media)g.media.show();else{g.media=e("<div>",{className:"yoxview_mediaPanel"});g.image.hide();k.append(g.media)}g.media.html(a.html);
J.css({width:ia.width,height:ia.height,top:f.height/2-ia.height/2});if(!k.isMedia){g.image.hide();k.isMedia=true}c.autoHideInfo!==false&&W();K.css("display","none");V=true}ja?k.animate({width:f.width,height:f.height},c.popupResizeTime):k.css({width:f.width+"px",height:f.height+"px"});a=Math.round((s.height-f.height)/2);b=Math.round((s.width-f.width)/2);if(va){va=false;ca.stop().stopTime().fadeOut(c.buttonsFadeTime)}N=true;wa(f.width,f.height,a,b,function(){if(ja){h.isOpen=true;if(c.controlsInitialDisplayTime>
0){c.showButtonsOnOpen&&J.animate({opacity:0.5},c.controlsInitialFadeTime,function(){c.buttonsFadeTime!=0&&e(this).delay(c.controlsInitialDisplayTime).animate({opacity:0},c.controlsInitialFadeTime)});if(c.showBarsOnOpen){Ba(function(){if(c.autoHideMenu!==false)xa=setTimeout(function(){sa()},c.controlsInitialDisplayTime)});da(function(){if(c.autoHideInfo!==false)Z=setTimeout(function(){W()},c.controlsInitialDisplayTime)})}}c.autoPlay&&h.play();c.onOpen&&c.onOpen();if(ka){ka();ka=undefined}ja=false}N=
false});k.css("z-index","2");ha.css("z-index","1");k.fadeIn(c.popupResizeTime,function(){ha.css("display","none");da(function(){if(c.autoHideInfo!==false)Z=setTimeout(function(){W()},c.titleDisplayDuration)});if(j>1){r<j-1&&c.cacheImagesInBackground&&u(r+1);p&&fa()}})}function Ma(a,b,d,f,g){jQuery.jsonp({url:Na[a]||"http://oohembed.com/oohembed/",data:jQuery.extend({url:b,format:"json"},d),dataType:"jsonp",callbackParameter:"callback",success:function(l){var m={title:l.title,width:l.width,height:l.height,
type:l.type};if(l.type==="video")m.html=l.html.replace(/<embed /,'<embed wmode="transparent" ').replace(/<param/,'<param name="wmode" value="transparent"><param').replace(/width=\"[\d]+\"/ig,'width="100%"').replace(/height=\"[\d]+\"/ig,'height="100%"');else l.type==="photo"&&jQuery.extend(m,{src:l.url,alt:l.title,type:"image"});f(m)},error:function(l,m){g&&g(l,m)}})}function Ia(a){try{if(!a)throw"Error: Media is unavailable.";if(!a.type||a.type==="image"){ya.src="";ya.src=a.src}else a.loaded?ga(D.media):
Da(a,function(d){ga(d)},function(d){la("Error getting data from:<br /><span class='errorUrl'>"+d.data.url+"</span>")})}catch(b){la(b)}}function Da(a,b,d){if(!a.type||a.type!=="image")Ma(a.provider,a.url,c.videoSize,function(f){e.extend(a,f,{loaded:true});b&&b(a)},d)}function la(a){ga({html:"<span class='yoxview_error'>"+a+"</span>",width:500,height:300,type:"error",title:""})}var h=this,e=jQuery,ca,Ca=new Image,ea,J,A=0,D,r=0,o={},ma=0,na=w,V=false,ja=true,G,Z,xa,E,R,t,j=0,X,ta,L,Ha=30,K,Y,p=this.isOpen=
false,N=false,va=false,ia={width:100,height:100},Na={vimeo:"http://vimeo.com/api/oembed.json",myspace:"http://vids.myspace.com/index.cfm?fuseaction=oembed"},La=-42,C,aa,U=[],ka,c=na,z,y,i,ua,I,$=false,ya=new Image,S,qa,n,F=[],s,Oa={40:"DOWN",35:"END",13:"ENTER",36:"HOME",37:"LEFT",39:"RIGHT",32:"SPACE",38:"UP",72:"h",27:"ESCAPE"},Pa={RIGHT:c.isRTL?"prev":"next",DOWN:"next",UP:"prev",LEFT:c.isRTL?"next":"prev",ENTER:"play",HOME:"first",END:"last",SPACE:"next",h:"help",ESCAPE:"close"},T=new Yox.Sprites({notifications:{width:59,
height:59,sprites:["empty","playRTL","play","pause","last","first"]},icons:{width:18,height:18,sprites:["close","help","play","link"]},menu:{height:42,sprites:["back"]}},c.imagesFolder+"sprites.png",c.imagesFolder+"empty.gif");this.AddViews=function(a,b){var d=this.firstViewWithImages!=undefined;jQuery.each(a,function(){q(this,F.length,b);F.push(this);if(!h.firstViewWithImages){var f=e(this).data("yoxview").images;if(f&&f.length!=0)h.firstViewWithImages=this}});if(!d&&this.firstViewWithImages){O(this.firstViewWithImages);
oa();b.cacheImagesInBackground&&j!=0&&u(0);d=true}};this.SetImages=function(a){j=a.length};var za={youtube:/.*youtube.com\/watch.*(?:v=[^&]+).*/i,vimeo:/vimeo.com\/\d+/i,hulu:/hulu.com\/watch\//i,viddler:/viddler.com\//i,flickr:/.*flickr.com\/.*/i,myspace:/.*vids.myspace.com\/.*/i,qik:/qik.com/i,revision3:/revision3.com/i,dailymotion:/dailymotion.com/i,"5min":/.*5min\.com\/Video/i};this.openGallery=function(a,b,d){if(typeof a=="function"){d=a;a=b=0}else if(typeof b=="function"){d=b;b=0}a=a||0;b=b||
0;O(F[a]);!i&&j!=0&&oa();c.cacheImagesInBackground&&u(b);this.selectImage(b);i.parent().stop().fadeIn("slow");if(d)ka=d;return false};this.selectImage=function(a){D=t[a];r=a;Q(true);S.blur();z.css({"z-index":"1",width:n.width,height:n.height});y.css({display:"none","z-index":"2"});ja=true;i.css({width:n.width,height:n.height,top:n.top,left:n.left});this.select(a)};this.refresh=function(){($=p)&&M();p||Ea();Ia(D.media);$&&fa()};this.select=function(a,b){if(typeof b==="number")b=undefined;if(!N){if(a<
0)a=j-1;else if(a==j)a=0;if(!p&&b){var d=b;d.css("opacity")==0&&d.stop().animate({opacity:0},c.buttonsFadeTime,Ka(d))}D=t[a];r=a;p||Ea();Ia(D.media);c.onSelect&&c.onSelect(a)}};this.prev=function(){this.select(r-1,I);return false};this.next=function(){this.select(r+1,aa);return false};this.first=function(){H(U.first);this.select(0);return false};this.last=function(){H(U.last);this.select(j-1);return false};this.play=function(){if(j!=1)if(p){H(U.pause);M()}else{H(U.play);fa()}};this.close=function(){this.closeHelp();
Q(false);wa(n.width,n.height,n.top,n.left);ua.stop().animate({opacity:0},"slow");this.isOpen=false;sa();W();k.animate({width:n.width,height:n.height,opacity:0},c.popupResizeTime,function(){i.parent().stop().fadeOut("slow",function(){k.css("opacity",1);ua.css("opacity",c.backgroundOpacity)})});p&&M();c.onClose&&c.onClose();N=false};this.help=function(){if(this.isOpen)G.css("display")=="none"?G.css("display","block").stop().animate({opacity:0.8},c.buttonsFadeTime):this.closeHelp()};this.closeHelp=function(){G.css("display")!=
"none"&&G.stop().animate({opacity:0},c.buttonsFadeTime,function(){G.css("display","none")})};this.clickBtn=function(a,b){b&&p&&M();a.call(this);return false};this.AddViews(v,c);e(document).delegate("*","keydown",function(a){if(h&&h.isOpen){var b=h[Pa[Oa[a.keyCode]]];if(b){a.preventDefault();b.apply(h)}}});e(window).bind("resize.yoxview",function(){s=Ga();h.isOpen&&h.resize()});e(Ca).load(function(){e.extend(t[A].media,{width:this.width,height:this.height,loaded:true});A<j&&u(A+1)}).error(function(){A<
j&&u(A+1)});this.startCache=function(){O(this.firstViewWithImages);u(0)};var k=z,ha=y;s=Ga();this.resize=function(){if(p){$=true;M()}var a=k.data("maxSize");if(a&&a){a=Fa(a.width,a.height,s.usableWidth,s.usableHeight);k.css({width:"100%",height:"100%"});var b=Math.round((s.height-a.height)/2),d=Math.round((s.width-a.width)/2);N=true;k.isMedia&&J.animate({top:a.height/2-ia.height/2},c.popupResizeTime);wa(a.width,a.height,b,d,function(){var f=i.width(),g=i.height();k.css({width:f+"px",height:g+"px"});
N=false;da();if($){fa();$=false}})}};e(ya).load(function(){this.width==0?la("Image error"):ga(e.extend({},D.media,{width:this.width,height:this.height}))}).error(function(){la("Загрузка...")});this.unload=function(){jQuery.each(F,function(a,b){e(b).undelegate("a","click.yoxview").removeData("yoxview").yoxthumbs("unload","yoxview")});e(window).unbind(".yoxview");if(i){i.parent().remove();i=undefined}}};
