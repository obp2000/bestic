/*!
 * YoxView Flickr plugin
 * http://yoxigen.com/yoxview/
 *
 * Copyright (c) 2010 Yossi Kolesnicov
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Date: 14th June, 2010
 * Version : 1.92
 */ 
function yox_flickr(){function m(a,i){return"http://farm"+a.farm+".static.flickr.com/"+a.server+"/"+(a.primary||a.id)+"_"+a.secret+i+".jpg"}var g=jQuery,n="http://api.flickr.com/services/rest/",q=/\d+@N\d+/,r=/http:\/\/(?:www\.)?flickr\.com\/(\w+)\/(?:([^\/]+)\/(?:(\w+)\/?(?:([^\/]+)\/?)?)?)?(?:\?(.*))?/,s=this,o={api_key:"cd6c91f9721f34ead20e6ebe03dd5871",format:"json"};this.getImagesData=function(a,i){function j(){var b={};a.onLoadBegin&&a.onLoadBegin();g.jsonp({url:n,async:false,dataType:"jsonp", data:f,callbackParameter:"jsoncallback",success:function(k){b.images=s.getImagesDataFromJson(k,f);if(k.photosets||k.collections)g.extend(b,{createGroups:true});i&&i(b);a.onLoadComplete&&a.onLoadComplete()},error:function(){a.onLoadError&&a.onLoadError("Flickr plugin encountered an error while retrieving data")}})}var h=true,l={method:"flickr.urls.lookupUser",onData:function(b){return{user_id:b.user.id,username:b.user.username._content}}},c={};if(a.dataUrl){var d=a.dataUrl.match(r),e;if(d[5]){e=Yox.queryToJson(d[5]); g.extend(c,e)}if(d&&d.length>1)if(d[1]=="search"){c.method="flickr.photos.search";c.text=e.q;if(e.w){e.w=e.w.replace("%40","@");if(e.w.match(q))c.user_id=e.w}if(!e||!e.sort)c.sort="relevance";h=false}else{switch(d[3]){case undefined:c.method="flickr.people.getPublicPhotos";break;case "sets":g.extend(c,{method:d[4]||a.dataSourceOptions.photoset_id?"flickr.photosets.getPhotos":"flickr.photosets.getList",photoset_id:d[4]});break;case "galleries":g.extend(c,{method:d[4]?"flickr.galleries.getPhotos":"flickr.galleries.getList", gallery_id:d[4]});if(d[4]){h=true;l={method:"flickr.urls.lookupGallery",onData:function(b){return{gallery_id:b.gallery.id,title:b.gallery.title}}}}break;case "collections":g.extend(c,{method:"flickr.collections.getTree",collection_id:d[4]});break;default:c.method="flickr.photos.search";break}g.extend(c,{username:d[2],type:d[3]})}}var f=jQuery.extend({},{imageSize:"medium",thumbsize:"smallSquare",setThumbnail:true,setSinglePhotosetThumbnails:true,setTitle:true,method:"flickr.photosets.getList",extras:"description"}, c,a.dataSourceOptions,o);f.media="photos";if(f.user&&f.photoset_id)f.method="flickr.photosets.getPhotos";c=screen.width>screen.height?screen.width:screen.height;if(!f.imageSize||c.width<=800&&f.imageSize!="medium")f.imageSize="medium";h?g.jsonp({url:n,async:false,dataType:"jsonp",data:g.extend({url:a.dataUrl,method:l.method},o),callbackParameter:"jsoncallback",success:function(b){g.extend(f,l.onData(b));j()}}):j()};var p={smallSquare:"_s",thumbnail:"_t",small:"_m",medium:"",large:"_b",original:"_o"}; this.getImagesDataFromJson=function(a,i){var j=a.photoset||a.photos,h;if(j)h=a.photoset?a.photoset.photo:a.photos.photo;else if(a.photosets)h=a.photosets.photoset;else if(a.collections)h=a.collections.collection[0].set;var l=[],c=a.photoset?"/in/set-"+a.photoset.id:"";if(h){var d=p[i.thumbsize],e=p[i.imageSize];jQuery.each(h,function(f,b){var k={thumbnailSrc:m(b,d),link:("http://www.flickr.com/photos/"+(b.owner||i.user_id)+"/"+b.id+c).replace(/\s/g,"_"),media:{src:m(b,e),title:j?b.title:b.title._content+ (!j?" ("+b.photos+" images)":""),alt:b.title._content||b.title,description:b.description?b.description._content:undefined}};if(!j)k.data={photoset_id:b.id};l.push(k)})}return l}};